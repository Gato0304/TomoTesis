Se puede aplicar el método HIL para una alta variedad de procesos, los cuales pueden ser sistemas simples como controlar la presión del agua, hasta sistemas más complejos como el sistema de control de movimiento de un automóvil. 

En este capítulo se muestran algunos conceptos relacionados al método HIL y a los motores de corriente continua, que servirán de soporte para la descripción del modelo del sistema y el controlador.

\section{Hardware in the Loop}\label{HILdef}

HIL es un método en donde los comandos de un controlador son conectados a un sistema en el cual se realizan pruebas. El controlador es conectado a este sistema de emulación con la finalidad de que este se comporte como si el producto final estuviera ensamblado y terminado. Por este motivo requiere un desarrollo en tiempo real, de esta manera se pueden realizar las pruebas e iteraciones necesarias para validar el componente.

 La emulación se realiza en tiempo real, consta de un controlador que se conecta con estímulos virtuales realistas que se usa para determinar si el modelo utilizado para el sistema es válido. Al emplear el método HIL se obtiene ahorro en costos y optimización del proceso, ya que al  evaluar el controlador por separado se pueden detectar los problemas y hacer cambios en el diseño sin la necesidad de tener el hardware.

El uso de HIL permite combinar dos métodos en los cuales es posible evaluar dispositivos embebidos de control. El primero consiste en que las pruebas realizadas son verificadas en una emulación de los componentes dinámicos, y el segundo método se basa en realizar ensayos con dispositivos de hardware.
 

Los primeros usos del método HIL comienza en la segunda mitad del siglo XX para el desarrollo y prueba de sistemas muy complejos y costosos, como los utilizados en las tácticas militares o sistemas satelitales y de centro de control nuclear o de vuelo. No obstante, al pasar del tiempo el método HIL fue utilizado en varias disciplinas siendo habitualmente empleado en la aplicación de circuitos de control a lazo cerrado. 

Una ventaja del método HIL, es que se reduce la posibilidad de que después que el producto se encuentra en producción se descubran problemas graves en su funcionamiento. Es una herramienta que se utiliza para optimizar el diseño y para depurar el hardware/software.

En la figura  \ref{fig:hilexperimental} se muestra una comparación entre realizar una prueba en condición real, con una simulación y el método HIL. La prueba real puede aumentar el costo y el tiempo de implementación, si tomamos un ejemplo de un sistema de navegación de un avión, si se hace una prueba real puede resultar en una tragedia, además de tener la posibilidad de destrucción del avión. Si por el contrario se realiza solo la simulación, el tiempo y el costo disminuyen pero se ve comprometida la precisión del objetivo. Por esta razón el método HIL logra un balance adecuado entre tiempo, costo y precisión.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{img/hilexperimental}
	\caption{Compensación de precisión, tiempo y costo en simulación por computadora, simulación HIL y situación real}
	{Fuente: \cite{pouriahil}}
	\label{fig:hilexperimental}
\end{figure}

Algunos factores que se toman en cuenta para aplicar el método HIL son los siguientes:

\begin{itemize}
	\item Para pruebas muy costosas o que pueden causar mucho daño en el sistema real.
	\item Cuando los parámetros no son lineales y difíciles de obtener con precisión en la realidad.
	\item Si el software de control tiene una complejidad elevada.
\end{itemize}

Una de las técnicas utilizadas en la ingeniería es el diagrama de V el cual se representa con los siguientes pasos: diseño, desarrollo, implementación y prueba del sistema. En la figura \ref{fig:ciclov} se muestra cómo en el ciclo de integración se recurre al método HIL, para luego realizar las pruebas de campo necesarias y en el caso que lo amerite la producción del producto.

En el diagrama V mostrado en la figura \ref{fig:ciclov}, nos muestra que el desarrollo del proyecto comienza con el diseño el cual busca definir los requerimientos, especificaciones y el modelado de los componentes del proyecto. Continua con la etapa para el desarrollo donde se realiza la construcción e implementación de los componentes y finalmente muestra la implementación e integración que permite la producción del producto final.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\linewidth]{img/diagramav}
	\caption{Ciclo en V para el desarrollo de proyectos en la industria.}
	{Fuente: \cite{pouriahil}}
	\label{fig:ciclov}
\end{figure}

El método HIL se estructura de la siguiente manera:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{img/estructurahil}
	\caption{Estructura general de un sistema de emulación HIL}
	{Fuente: \cite{jaimehil}}
	\label{fig:estructurahil}
\end{figure}

Como se aprecia en la figura \ref{fig:estructurahil}, el método HIL se divide en tres componentes  básicos, los cuales son:

\begin{itemize}
	\item El modelo de la planta.
	\item La interfaz de comunicación.
	\item El controlador o hardware del sistema.
\end{itemize} 

En primer lugar se encuentra el modelo de la planta emulada, la cual debe ser programada. El sistema se puede utilizar desde una computadora hasta un dispositivo como un microcontrolador que actue como esclavo y esté conectado a un sistema superior, también se pueden incluir actuadores y sensores de ser necesario para completar el sistema de control. 

El componente del Hardware (DUT)  es el elemento de control del sistema a lazo cerrado, este controlador recibe las salidas del modelo simulado. En esta parte se encuentra el algoritmo en el cual se establecen las acciones de control que son transmitidas al emulador para poder hacer las pruebas respectivas sobre el sistema.

 En la componente de comunicación entre la planta y el controlador, existen varias alternativas las cuales se escogen dependiendo de los requerimientos del sistema de control, un ejemplo puede ser la conversión de señales analógicas y digitales, el bus de comunicación serial o paralelo y los protocolos de red.
 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
 %TODO: APENDICE ESPECIFICO DE LO QUE SE QUIERE
 
 En referencia para la implementación de este trabajo, según la estructura propuesta en la figura \ref{fig:estructurahil} y lo descrito en los párrafos anteriores, el diagrama específico para conseguir el resultado planteado se muestra en la figura %\ref{}
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
 \section{Motor de corriente continua (CC)}
 
 Los motores de corriente continua son máquinas eléctricas cuya función es producir energía mecánica a partir de energía eléctrica, estos motores se distinguen por ser de diseños sencillos, económicos y precisos de control de velocidad. Existen varias aplicaciones para este tipo de motores como elevadores, fabricación de papel, actuadores para mover mecanismos de brazos mecánicos, entre otros.
 
 Suelen clasificarse en motores CC con escobillas y sin escobillas (motores brushless). Los motores de CC con escobillas están constituidos por cuatro partes:  el estator (parte fija del motor), el rotor (armadura del motor), el colector y las escobillas. Poseen una estructura como la que se puede apreciar en la figura \ref{fig:motorcc}.
 
  Entre el estator y el rotor, siendo el estator el componente fijo y el rotor el componente móvil, se producen flujos magnéticos que interactúan entre sí, con el objetivo de producir un par electromagnético colineal con el eje del motor.
 
 \begin{figure}[H]
 	\centering
 	\includegraphics[width=0.7\linewidth]{img/motorcc}
 	\caption{Diagrama de una máquina CC}
 		{Fuente: \cite{imagencc}}
 	\label{fig:motorcc}
 \end{figure}
 
 \section{Control por armadura de un motor CC}
 En la figura \ref{fig:modelomotor} se observa el modelo  de un motor CC controlado por armadura
 
  \begin{figure}[H]
 	\centering
 	\includegraphics[width=0.7\linewidth]{img/motordcarmadura}
 	\caption{Modelo de un motor CC controlado por armadura.}
 	\label{fig:modelomotor}
 \end{figure}

A continuación, se definen los parámetros y  variables que se utilizan:

\begin{itemize}
	\item $	R_{a}$= resistencia de armadura. 
	\item $I_{a}$= corriente de armadura.
	\item $I_{f}$= corriente de campo.
	\item $L_{a}$= inductancia de armadura.
	\item $e_{a}$= voltaje aplicado.
	\item $e_{b}$= fuerza contraelectromotriz.
	\item $\theta$= desplazamiento del rotor.
	\item $k_{f}$= constante de proporcionalidad.
	\item $k_{b}$= constante de la fuerza contraelectromootriz.
	\item $k_{i}= k$= constante del par.
	\item Ø= flujo magnético en el entrehierro.
	\item $J_{m}$=inercia del rotor.
	\item $B_{m}$=coeficiente de fricción viscosa.
	\item $\tau_{m}$= par del motor.
\end{itemize}
 
 Este tipo de motores el campo es excitado por una corriente constante $I_{f}$ generada por una fuente DC fija. Entonces el flujo es Ø=$K_{f}$*$I_{f}$, donde $K_{f}$  es constante. El par desarrollado por el motor es proporcional al producto del flujo y la corriente de armadura. Este par tiene la función de accionar el sistema que posee una inercia total $J_{eq}$ y $\theta$ es la posición angular del eje del motor.
 
 El rotor cuando gira genera un campo, en el cual se crea un voltaje inducido $e_{b}$  llamado fuerza contraelectromotriz y es proporcional a la velocidad de rotación $\omega_{n}$. 
 
 La armadura de un motor DC se modela con un circuito con una resistencia $R_{a}$ en serie con una inductancia $L_{a}$ y una fuente de voltaje $e_{b}$ que representaría la fuerza contraelectromotriz cuando el motor está en movimiento. El diagrama de bloques que representa a este tipo de motores es:
 
 \begin{figure}[H]
 	\centering
 	\includegraphics[width=0.7\linewidth]{img/diagramadebloquesarmadura}
 	\caption{Diagrama de bloques de un motor DC controlado por armadura}
 	\label{fig:diagramadebloquesarmadura}
 \end{figure}

Se tomó en cuenta la siguiente aproximación para obtener un análisis lineal en las ecuaciones y el diagrama de bloques de un motor DC controlado por armadura:
\begin{center}
$\tau_{m}=k_{m}$Ø$i_{a}$	
\end{center}

Ya que Ø es constante entonces la ecuación queda:

\begin{center}
	 $\tau_{m}=k_{i}i_{a}$
\end{center}

El motor CC controlado por armadura es un sistema a lazo abierto, aunque el diagrama de bloques muestre un lazo realimentado provocado por la fuerza contraelectromotriz, la cual representa la realimentación que es proporcional al negativo de la velocidad del motor. Entonces $k_{b}$ es la constante que se añade a la resistencia $R_{a}$ y al coeficiente de fricción viscosa $B_{m}$, por este motivo la fuerza contraelectromotriz ayuda a mejorar la estabilidad del sistema. 
  
 
 Para controlar la velocidad se debe  ajustar el voltaje que es aplicado a la armadura y dependiendo de su polaridad se determina la dirección de rotación del motor.  Las ecuaciones  que representan un control por armadura de un motor DC son las siguientes:
\begin{center}
	\begin{equation}\label{ec:motorarmadura1}
		 \tau_{m}= J_{m} \frac{d^{2}\theta}{dt^{2}}+B_{m}\frac{d\theta}{dt}
	\end{equation}
\end{center}

\begin{center}
	\begin{equation}\label{ec:motorarmadura2}
			e_{a}=R_{a}I_{a}+L_{a}\frac{di_{a}}{dt}+ e_{m}
	\end{equation}
\end{center}

\begin{center}
	\begin{equation}\label{ec:motorarmadura3}
		e_{m}=k_{m}\frac{d \theta }{d t} = k_{m}\omega_{m}
	\end{equation}
\end{center}


\begin{center}
	\begin{equation}\label{ec:motorarmadura4}
		\tau_{m}=k_{i}I_{a}
	\end{equation}
\end{center}

         
\section{Control por campo} 
En la figura \ref{fig:motorcampo} se observa el modelo de un motor DC controlado por campo:
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{img/motorcampo1}
	\caption{Modelo de un motor DC controlado por campo}
	\label{fig:motorcampo}
\end{figure}
      

La corriente de armadura se mantiene constante y el campo tiene un voltaje ajustable $e_{f}$.  El par que se crea por el motor es proporcional al flujo que se genera por la corriente de armadura, la corriente de campo y la longitud de los conductores, el par es utilizado para mover la carga de inercia total y vencer la fricción viscosa. El modelado del diagrama de bloques se representa de la siguiente manera:
          
  \begin{figure}[H]
 	\centering
 	\includegraphics[width=0.7\linewidth]{img/motorcampo}
 	\caption{Motor DC controlado por campo}
 	\label{fig:ecuacionesmotorcampo}
 \end{figure}

 Las ecuaciones que representan al motor DC controlado por campo son las siguientes:  
 
 
 \begin{center}
 	\begin{equation}\label{ec:motorcampo1}
 	\tau =k_{T} i_{f}
 	\end{equation}
 \end{center}

 	
 \begin{center}
 	\begin{equation}\label{ec:motorcampo2}
 	\tau =J\frac{d^{2}\theta}{dt}+B\frac{d\theta}{dt}
 	\end{equation}
 \end{center}

 	\begin{center}
 		\begin{equation}\label{ec:motorcampo3}
 			e_{f}=R_{f} i_{f}+ L_{f}\frac{d i_{f} }{d t} 
 		\end{equation}
 	\end{center}	
 	

	


%Se seleccionará la plataforma tecnológica para el diseño de la interfaz de emulación, incluyendo información fundamental sobre los conceptos relacionados al tema.



%Según la Real Academia Española la palabra emular se puede definir como $"$imitar las acciones de otro procurando igualarlas e incluso excederlas$"$ {\cite{raeemular}}, como ya se explico anteriormente el método HIL utilizá una mezcla entre un controlador real y un emulador que en este caso es la planta de segundo orden. Para esto se necesita un emulador que se puede definir como un dispositivo que cuenta con un software el cual es capaz de replicar otro dispositivo o componente para igualarlo  o mejorarlo, para el caso de esta tesis será una planta de segundo orden.


%Emulación vs Simulación
%\section{Simular }
%Simulación
%Una simulación computacional es un proceso que consiste en utilizar funciones o técnicas matemáticas para aproximar el modelo de un sistema dinámico, entonces el algoritmo que se utilice debe evaluar el modelo en un intervalo de tiempo, para asi poder obtener las variables caracteristicas del sistema simulado{\cite{simulacion}}

%Emulación
%\section{Emular}
%Según la RAE, un proceso de emulación se define como $"$imitar las acciones de otro procurando igualarlas e incluso excederlas$"$ {\cite{raeemular}}. En este sentido, un emulador se puede definir como un dispositivo que cuenta con un software el cual es capaz de replicar a otro dispositivo o componente para igualarlo  o mejorarlo. {\cite{larusse}}

\section{Controlador PID}

El primer controlador de este tipo que se incorporó fue el Fulscope modelo 100, el cual fue creado por la empresa Taylor Instruments en 1940. A partir de la creación de éste, se originaron múltiples y diversas formas de referirse a él.

Los nombres que se encuentran en la literatura técnica son controlador PID, PI-D,I-PD, con un grado de libertad o de dos grados de libertad, interactuante o no interactuante, clásico, paralelo o serie, tipo A, B, C o D. \cite{Victor}


\section{Diferencias entre simular y emular}

El proceso de emular y simular tienen diferentes definiciones, por este motivo en la tabla \ref{tab:simulacionvsemulacion} se exponen las diferencias más significativas.
   
\begin{table}[H]
	
	\caption{Diferencias entre simular y emular}
	\begin{center}	
		\begin{tabular}{|p{17.5em}|p{17.5em}|}
			
			\hline
			\textbf{Simular } & \textbf{Emular} \\
			\hline
			No incorpora módulos periféricos de harware adicionales  & Es aplicado en sistemas de Software y hardware \\
			\hline
			No necesariamente cumple con todas las reglas del sistema que simula & Las reglas son fijas y no se pueden cambiar o el sistema falla \\
			\hline
			Se puede separar la simulación del mundo real  & Tiene el objetivo de ocupar el lugar de la realidad  \\
			\hline
			Son más utilizados para pruebas de comportamiento interno de equipos & Son más utilizados para pruebas del comportamiento externo de otros equipos \\
			\hline
		\end{tabular}%
	\end{center}
	\label{tab:simulacionvsemulacion}%
\end{table}%
