En este capítulo se explican los fundamentos necesarios para el modelado de la planta de segundo orden y el motor escogido para tener un referente en el sistema. A demás, se realiza una comparación entre el circuito Sallen-Key y sistema emulado.  

\section{Fundamentos}
Para el modelado de la planta se tomó en cuenta las ecuaciones de un motor CC contolado por armadura de segundo orden que cumple con las expresiones dadas en \ref{ec:motorarmadura}  . De donde se obtiene el sistema de ecuaciones mostrado en \ref{ec:motorarmadura2}.

\begin{center}
	\begin{equation}
		\left\{
		\begin{matrix}
			&\dot{\omega }_{m}=I_{a}\left ( \frac{K_{i}}{J_{m}} \right )-\omega_{m}\left (\frac{B_{m} }{J_{m}}\right )\\
			& \dot{I_{a}} = e_{a}\left( \frac{1}{L_{a}} \right)
			-I_{a}\left ( \frac{R_{a}}{L_{a}} \right)
			-\omega_{m}\left(   \frac{k_{m}}{L_{a}} \right)
		\end{matrix}
		\right.
		\label{ec:motorarmadura2}%
		%\textup{Ecuaciones de un motor DC controlado por armadura}	
	\end{equation}
\end{center}

%Se comenzó por emular un sistema de segundo orden  que permitiera obtener el comportamiento de la planta, para esto se tomó el sistema de un motor de segundo orden que cumple con las ecuaciones mostradas en \ref{ec:motorarmadura}.

Tomando como variables de estado la velocidad angular del motor ($\omega_{m}$) y la corriente de armadura ($I_{a}$), sabiendo que la corriente de campo es constante ($I_{f}$), se toman las ecuaciones \ref{ec:espaciodeestado1q} en el siguiente espacio de estado:
 
\begin{center}
	\begin{equation}
		\left\{\begin{matrix}
			\begin{bmatrix}
				& \dot{\omega _{m}}\\ 
				& \dot{I_{a}}
			\end{bmatrix}
			=
			\begin{bmatrix}
				& \frac{-B_{m}}{J_{m}} & \frac{K_{i}}{J_{m}} & \\ 
				&  \frac{-K_{m}}{L_{a}}& \frac{-R_{a}}{L_{a}} & \\ 
			\end{bmatrix}
			\begin{bmatrix}
				& \omega _{m} \\ 
				& I_{a}
			\end{bmatrix}
			+
			\begin{bmatrix}
				& 0 \\ 
				& \frac{1}{L_{a}}
			\end{bmatrix}
			e_{a}\\ 
			Y=\begin{bmatrix}
				1 & 0
			\end{bmatrix}
			\begin{bmatrix}
				\omega_{m}\\ 
				I_{a}
			\end{bmatrix}
		\end{matrix}\right.	
		\label{ec:espaciodeestado1q}%
	\end{equation}
\end{center}

%Para el trabajo de grado se tomo en cuenta

Según \cite{kuo}  las constantes del par $k_{i}$ y la constante de fuerza contraelectromotriz $k_{b}$ son dos parámetros que estan relacionados a traves de la potencia mécanica, la cúal se escribe de la siguiente manera:

\begin{center}
	\begin{equation}
		P=e_{b}(t)i_{a}(t)
		\label{ec:potencia}%
		%\textup{Ecuaciones de un motor DC controlado por armadura}	
	\end{equation}
\end{center}

También se puede expresar como:

\begin{center}
	\begin{equation}
		P= \tau_{m}(t)\omega_{m}(t)
		\label{ec:potencia2}%
		%\textup{Ecuaciones de un motor DC controlado por armadura}	
	\end{equation}
\end{center}

Se obtiene que:

\begin{center}

		
	$	k_{b} (V/rad/sec)= k_{i} (Nm/A)$
		\label{ec:potencia3}%
		%\textup{Ecuaciones de un motor DC controlado por armadura}	

\end{center}

Entonces en el sistema SI, los valores de $k_{b}$ y $k_{i}$ son iguales.
 \section{DCMCT}
 
 
 Se estudió el sistema "Quanser DC Motor Control Trainer" (DCMCT), el cual será referenciado en este documento como motor Quanser. En las especificaciones técnicas de este dispositivo se exponen los parámetros indicados en la figura \ref{fig:Quanser}.
 
 
 
  \begin{figure}[H]
 	\centering
 	\includegraphics[width=1\linewidth]{img/quanser}
 	\caption{Parámetros Quanser}
 	\label{fig:Quanser}
 	\cite{quanser}
 \end{figure}  


Para la representación de los parámetros del motor Quanser en espacio de estados se toman los valores que tienen los parametros  expuestos en la tabla \ref{fig:Quanser}. 

Para el cálculo del momento de inercia equivalente del motor ($J_{equi}$) se tomó el parámetro $ J_{m}$ y los valores de la masa del disco $M_{l}=0.068kg$ y el radio del disco $r_{l}=0.0248m$.
 
 \begin{center}
 	\begin{equation}
 		J_{equi}=J_{m}+J_{l}\left ( \frac{R_{eje}}{R_{l}} \right )
 	\end{equation}
\end{center}

Donde $ J_{l}=\frac{M_{l}r_{l}^{2}}{2}$ y las relaciones entre los radios es de 1.



\begin{center}
	\begin{equation}
		J_{equi}=J_{m}+\frac{M_{l}r_{l}^{2}}{2}
	\end{equation}
\end{center}

A continuación en \ref{ec:valoresmotorarmadura} se agrupan los parámetros que se utilizarán para la representación del modelo del sistema.   
 \begin{center}
	 \begin{equation}
		\begin{matrix}
			K_{m}=0.0502\frac{Nm}{A}\\ 
			J_{equiv}= 21,4567*10^{-6} Kg.m^{2}\\ 
			R_{a}=10.6\Omega\\ 
			L_{a}=0.82m H	
		\end{matrix}
		 \label{ec:valoresmotorarmadura}%
	\end{equation}
\end{center}

De acuerdo con la información presentada anteriormente se obtiene el modelo de espacio de estado descrito con la ecuación \ref{ec:espaciodeestado1q} y \ref{ec:espaciodeestado2q}. Del cual se obtiene la función de transferencia indicada en la ecuación \ref{ec:plantaarmadura}. 


%El sistema de segundo orden emulará es el motor Quanser la cual cumple con las características anteriores, para así poder realizar las pruebas necesarias para evaluar el comportamiento de la planta con un controlador real. Al realizar el espacio de estado de la planta se obtiene%



\begin{center}
	\begin{equation}
		\left\{\begin{matrix}
			\begin{bmatrix}
				& \dot{\omega _{m}}\\ 
				& \dot{I_{a}}
			\end{bmatrix}
			=
			\begin{bmatrix}
				& 0 & 2340 & \\ 
				&  -61,22& -1,293.10^{4} & \\ 
			\end{bmatrix}
			\begin{bmatrix}
				& \omega_{m} \\ 
				& I_{a}
			\end{bmatrix}
			+
			\begin{bmatrix}
				& 0 \\ 
				& 1220
			\end{bmatrix}
			e_{a}\\ 
			Y=\begin{bmatrix}
				1 & 0
			\end{bmatrix}
			\begin{bmatrix}
				\omega_{m}\\ 
				I_{a}
			\end{bmatrix}
		\end{matrix}\right.
	\label{ec:espaciodeestado2q}%	
	\end{equation}
\end{center}

\begin{center}
	\begin{equation}
		\frac{\omega_{m}(s)}{e_{a}(s)}= \frac{2.855e^{6}}{s^{2}+1.293e^{4}s+1.433e^{5}} 
		\label{ec:plantaarmadura}%
	\end{equation}
\end{center}

Según la ecuación \ref{ec:motorarmadura} $e_{m}=k_{m}\omega_{m}$ la ecuación \ref{ec:plantaarmadura} queda:

\begin{center}
	\begin{equation}
		\frac{e_{m}(s)}{e_{a}(s)}= \frac{1.433e^{5}}{s^{2}+1.293e^{4}s+1.433e^{5}} 
		\label{ec:plantaarmaduracompleta}%
	\end{equation}
\end{center}

Esto cumple con la ecuación \ref{ec:segundoorden}.

\section{Modelado del sistema con un circuito de segundo orden}

Con la funcion de transferencia planteda en  \ref{ec:filtroresistencia} y los valores obtenidos en \ref{ec:plantaarmaduracompleta}, se obtiene el siguiente sistema de ecuaciones:

\begin{center}
	\begin{equation}
		\left\{
		\begin{matrix}
			&   \omega_{n}^{2}=\frac{1}{R_{1}R_{2}C_{1}C_{2}} \\
			&   2\zeta \omega_{n}=\frac{R_{1}C_{1}+R_{2}C_{1}}{R_{1}R_{2}C_{1}C_{2}}
		\end{matrix}
		\right.
	\end{equation}
\end{center}

Donde los valores de $R_{1}, R_{2}, C_{1}, C_{2}$, $\omega_{n}$ y $\zeta$ son incógnitos, primero se obtendrán los valores de  $\omega_{n}$, y $\zeta$ a partir de la función de transferencia \ref{ec:plantaarmaduracompleta} y del modelo de un sistema de control segundo orden planteado en \ref{ec:segundoorden} :




\begin{center}
	\begin{equation}
		\begin{matrix}
		 &	\omega_{n}^{2}=1.433e^{5} \\
		 &	\omega_{n}=378.549
		\end{matrix}	
	\end{equation}
\end{center}  

\begin{center}
	\begin{equation}
		\begin{matrix}
			&	2\zeta\omega_{n}=1.293e^{4} \\
			&	\zeta= 17.078
		\end{matrix}	
	\end{equation}
\end{center}

Al tener cuatro incógnitas y dos ecuaciones, se fijan los valores de $C_{1}= 1\mu F $ y $ C_{2}= 470nF  $, obteniendo: 

%$R_{1}=150k\Omega,  R_{2}=100k \Omega $

\begin{center}
	\begin{equation}
		\begin{matrix}
			& R_{1}R_{2}=\frac{1}{\omega_{n}^{2}C_{1}C_{2}} \\
			&R_{2}=\frac{1}{\omega_{n}^{2}C_{1}C_{2}R_{1}} 			
		\end{matrix}
	\end{equation}
\end{center}


\begin{center}
	\begin{equation}
			 2\zeta \omega_{n}=\frac{R_{1}C_{1}+R_{2}C_{1}}{R_{1}R_{2}C_{1}C_{2}}	
			 \label{ec:despeje}
	\end{equation}
\end{center}


Sustituyendo el valor de $R_{2}$ en \ref{ec:despeje} queda una ecuación cuadrática con incógnita $R_{1}$ 

\begin{center}
	\begin{equation}
		R_{1}^{2}-\frac{2\zeta}{\omega_{n}C_{1}}  R_{1}+ \frac{1}{\omega_{n}^{2}C_{1}C_{2}}	= 0
		\label{ec:despejefinal}
	\end{equation}
\end{center}

Los valores que arroja la ecuación son $R_{1}$= $\left\lbrace   90128; 164.86\right\rbrace \Omega$  y el valor de $R_{2}= 164.86 \Omega$.

 La solución según el estándar E24 sería: $R_{1}=91k\Omega$ y $  R_{2}=160 \Omega $.

A continuación, se comparan las gráficas en la plataforma Matlab del sistema sin controlar y el modelo con el filtro Sallen-Key tambien emulado en Matlab pero con los valores de las resistencias y los condensadores.




\begin{figure}[H]
	\rotatebox[origin=c]{-90}{	\includegraphics[scale=0.50]{img/comparacion.eps}}
	
	\caption{Comparación entre el sistema original y Sallen-Key}
	\label{fig:QuanservsSallen}
\end{figure}
	
Se observa en el gráfico los siguientes resultados:

\begin{table}[htbp]
	\centering
	\caption{Parámetros de la comparación del sistema original y el circuito Sallen-Key en Matlab.}
	\resizebox{15cm}{!} {
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Sistemas considerados} & \textbf{tiempo de alza$(T_{r})$ (seg)} & \textbf{tiempo de establecimiento $(T_{s})$ (seg)} \\
		\hline
		Sallen-Key & 0.198 s & 0.353 s \\
		\hline
		Sistema original & 0.2 s & 0.356 s \\
		\hline
	\end{tabular}%
	\label{tab:addlabel}%
}
\end{table}%

Con la tabla \ref{tab:addlabel} se estudia el error porcentual asociado a estos modelos con la siguiente ecuación: 
\begin{center}
	\begin{equation}
		Error= \left |\frac{Valor_{sistemaoriginal} - Valor_{Sallen-Key}}{Valor_{sistemaoriginal}}*100 \%\right |	
		\label{ec:errorporcentual}
	\end{equation}
\end{center}

Se observa que el error porcentual calculado con \ref{ec:errorporcentual} dan los siguientes valores para el tiempo de alza y el tiempo de establecimiento:

\begin{center}
	\begin{equation}
		Error T_{r}= \left |\frac{0.198 - 0.2}{0.198}*100\%\right | =1.01\%	
		\label{ec:errorporcentualtalza}
	\end{equation}
\end{center}



\begin{center}
	\begin{equation}
		Error T_{s}= \left |\frac{0.353 - 0.356}{0.353}*100\%\right | =0.849\%	
		\label{ec:errorporcentualtesta}
	\end{equation}
\end{center}
Los errores al ser menores al dos $\%$ son valores validos para la aproximación de nuestro modelo.
%
%Para una planta de segundo orden genérica se tiene la ecuación \ref{ec:plantasegundo}
%\begin{center}
%	\begin{equation}
%		\frac{Y(s)}{U(s)}= \frac{b_{2}s^{2}+b_{1}s+b_{0}}{a_{2}s^{2}+a_{1}s+a_{0}} 
%		\label{ec:plantasegundo}%
%	\end{equation}
%\end{center}
%
%Como se pudo observar los motores de segundo orden que se van a estudiar tienen los valores de $b_{1}=0$ y $b_{2}=0 $ entonces la ecuación quedaría 
%
%\begin{center}
%	\begin{equation}
%		\frac{Y(s)}{U(s)}= \frac{b_{0}}{a_{2}s^{2}+a_{1}s+a_{0}} 
%		\label{ec:plantasegundo}%
%	\end{equation}
%\end{center}
%
%Resolviendo las ecuaciones diferenciales se tiene que 
%
%\begin{center}
%	\begin{equation}
%		\begin{matrix}
%		a_{2}\ddot{y}+a_{1}\dot{y}+a_{0}y=b_{0}U \\
%	 	x_{1}=y\\
%		\dot{x_{1}}=\dot{y}=\dot{x_{2}}\\
%		\ddot{x_{1}}=\ddot{y}=x_{3}\\
%		\label{ec:solecdiferencial2}%
%		\end{matrix}
%	\end{equation}
%\end{center}
%
%Obteniendo el siguiente espacio de estado
%
%\begin{center}
%	\begin{equation}
%		\begin{bmatrix}
%			\dot{x_{1}}\\
%			\dot{x_{2}}
%		\end{bmatrix}
%		=
%		\begin{bmatrix}
%			0 & 1\\ 
%			-\frac{a_{0}}{a_{2}}& -\frac{a_{1}}{a_{2}}
%		\end{bmatrix}x+
%		\begin{bmatrix}
%			0\\ 
%			\frac{b_{0}}{a_{2}}
%		\end{bmatrix}
%		\label{ec:espaciodestado2}%
%	\end{equation}
%\end{center}

\section{Diseño de la interfaz de emulación de la planta de segundo orden}

De acuerdo con la tabla \ref{tab:requisitos}, la plataforma tecnológica seleccionada para el diseño esta basada en el lenguaje de programación Python. 

\subsection{Interfaz gráfica}
Para el diseño de la interfaz gráfica se consideró el paquete Tkinter, que es parte de la herramientas que se pueden utilizar en Python de forma nativa. Esta herramienta se configuró para que se permita cambiar los parámetros que componen a la ecuaciones del sistema de segundo orden, además de contener las siguientes acciones:

\begin{itemize}
	\item Selección del puerto para la comunicación serial con el controlador.
	\item La configuración de los parámetros del sistema de segundo orden.
	\item Configuración de los parámetros del controlador.
	\item Graficar la respuesta controlada y sin controlar.
	\item Obtener los datos de tiempo de alza, tiempo de establecimiento y sobrepico del sistema controlado.
\end{itemize}


Para esto se preestablecieron los datos para el funcionamiento del motor Quanser, los parametros se permiten cambiar para que se pueda emular cualquier sistema de segundo orden que cumpla con la ecuación dada en \ref{ec:plantasegundo}.

\begin{center}
	\begin{equation}
		\frac{Y(s)}{U(s)}= \frac{b_{0}}{a_{2}s^{2}+a_{1}s+a_{0}} 
		\label{ec:plantasegundo}%
	\end{equation}
\end{center}

Se habilitó otra entrada para poder insertar el puerto  por el cual se va a realizar la comunicación serial con el controlador real y un botón para conectarlo donde saldrá un mensaje de si la comunicación fue correcta o ocurrió un error en el proceso.

Se cuenta con un botón para iniciar la comunicación con el controlador y dos botones uno para graficar la respuesta controlada y otro para ver la respuesta original.

Por último, se mostrará los datos de sobrepico porcentual, tiempo de establecimiento y tiempo de alza.


En el inicio del código se define las librerías que se utilizaran para el desarrollo del sistema de segundo orden, se decidirá el puerto serial de comunicación y la velocidad que tendrá el mismo. Las ventanas de error son las siguientes:
\begin{itemize}
	\item Error 01: Error si el campo de puerto esta vacío.
	\item Error 02: Error si no hay conexión de puerto.
	\item Error 03: Error si no se ha configurado  la planta.
	\item Error 04: Error con la conexión.
\end{itemize} 

Luego se definen los arreglos vacíos de entrada, salida y tiempo, con los inputs respectivos y se obtienen los valores del sistema de segundo orden  y las variables de los pasos siguientes se definen con valor de cero.

Al abrir la comunicación con el controlador se envía por el puerto serial un $"$o$"$ de y se comienza la comunicación enviando un cero y luego calculando los valores del sistema dependiendo de los valores que envié el controlador y la comunicación acaba cuando se termina el ciclo de una cantidad definida de valores antes de  salir.

Una vez terminada la comunicación se calcula los valores de sobrepico, tiempo de alza y tiempo de establecimiento, tomados de los valores que proporciona la gráfica.


En los siguientes diagramas se muestra la manera de en que se ejecuta las tareas del sistema:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{img/pserial}
	\caption{Conexión puerto serial }
	\label{fig:Pserial}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{img/confip}
	\caption{Configuración planta }
	\label{fig:confip}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.45\linewidth]{img/confic}
	\caption{Configuración de comunicación }
	\label{fig:confic}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{img/Graficos}
	\caption{Configuración de gráficos }
	\label{fig:Graficos}
\end{figure}
